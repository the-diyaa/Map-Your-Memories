<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memories</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            box-sizing: border-box;
        }
        
        .story-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .story-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .story-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent 60%, rgba(0,0,0,0.7));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
            pointer-events: none;
        }
        
        .story-card:hover::before {
            opacity: 1;
        }
        
        .story-card .story-actions {
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }
        
        .story-card:hover .story-actions {
            opacity: 1;
            transform: translateY(0);
        }
        
        .pinned-badge {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            z-index: 2;
        }
        
        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #4BA3C3 0%, #0B3954 100%);
        }
        
        .story-image {
            object-fit: contain;
            height: 200px;
            width: 100%;
            background: #f8f9fa;
        }
        
        .carousel-container {
            position: relative;
            overflow: hidden;
        }
        
        .carousel-track {
            display: flex;
            transition: transform 0.3s ease;
        }
        
        .carousel-slide {
            min-width: 100%;
            flex-shrink: 0;
        }
        
        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: background 0.3s ease;
            z-index: 10;
        }
        
        .carousel-nav:hover {
            background: rgba(0, 0, 0, 0.7);
        }
        
        .carousel-prev {
            left: 10px;
        }
        
        .carousel-next {
            right: 10px;
        }
        
        .carousel-indicators {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 10;
        }
        
        .carousel-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .carousel-dot.active {
            background: white;
        }

        .code-block {
            background: #1f2937;
            color: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            margin: 1rem 0;
            overflow-x: auto;
        }

        /* Enhanced Interactive Elements */
        .like-button {
            transition: all 0.2s ease;
        }
        
        .like-button:hover {
            transform: scale(1.1);
        }
        
        .like-button.liked {
            color: #ef4444;
        }
        
        .story-stats {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 350px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: #10b981;
        }
        
        .notification.error {
            background-color: #ef4444;
        }
        
        .notification.info {
            background-color: #3b82f6;
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4BA3C3 0%, #0B3954 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }
        
        .image-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .image-viewer.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .image-viewer img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }
        
        .image-viewer-close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            background: rgba(0,0,0,0.5);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: background 0.3s ease;
        }
        
        .image-viewer-close:hover {
            background: rgba(0,0,0,0.7);
        }
        
        .image-viewer-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            background: rgba(0,0,0,0.5);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            transition: background 0.3s ease;
        }
        
        .image-viewer-nav:hover {
            background: rgba(0,0,0,0.7);
        }
        
        .image-viewer-prev {
            left: 20px;
        }
        
        .image-viewer-next {
            right: 20px;
        }

        /* Mobile First Responsive Design */
        @media (max-width: 640px) {
            /* Navigation adjustments */
            .max-w-7xl {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            /* Hero section */
            h2 {
                font-size: 2rem !important;
                line-height: 1.2;
            }
            
            .text-xl {
                font-size: 1.125rem !important;
            }
            
            /* Modal adjustments */
            .modal-backdrop .bg-white {
                margin: 1rem;
                max-height: 90vh;
                overflow-y: auto;
            }
            
            /* Story cards */
            .story-card {
                margin-bottom: 1rem;
            }
            
            .story-card .p-6 {
                padding: 1rem !important;
            }
            
            /* Form inputs */
            input, textarea, select {
                font-size: 16px !important; /* Prevents zoom on iOS */
            }
            
            /* Button adjustments */
            .px-8 {
                padding-left: 1.5rem !important;
                padding-right: 1.5rem !important;
            }
            
            /* Search bar stack on mobile */
            .flex-col.md\\:flex-row {
                gap: 0.75rem;
            }
            
            .flex-col.md\\:flex-row > div {
                width: 100%;
            }
            
            /* Carousel controls */
            .carousel-nav {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            
            .carousel-prev {
                left: 5px;
            }
            
            .carousel-next {
                right: 5px;
            }
            
            /* Image preview grid */
            .grid-cols-2 {
                grid-template-columns: 1fr !important;
                gap: 0.5rem;
            }
            
            /* Floating action button */
            .floating-action-btn {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
            }
            
            /* Notification */
            .notification {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }

        @media (min-width: 641px) and (max-width: 768px) {
            /* Tablet adjustments */
            .text-4xl {
                font-size: 2.5rem !important;
            }
            
            .grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3 {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            
            /* Modal width for tablets */
            .max-w-md {
                max-width: 32rem;
            }
            
            .max-w-2xl {
                max-width: 42rem;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            /* Desktop small adjustments */
            .max-w-7xl {
                max-width: 1024px;
            }
            
            .grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3 {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }

        @media (min-width: 1025px) {
            /* Large desktop */
            .grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3 {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .story-card:hover {
                transform: none;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
            
            .story-card::before {
                display: none;
            }
            
            .story-card .story-actions {
                opacity: 1;
                transform: translateY(0);
            }
            
            button:hover {
                opacity: 1 !important;
            }
            
            .carousel-nav {
                background: rgba(0, 0, 0, 0.7);
            }
        }

        /* High DPI displays */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .story-image {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }

        /* Landscape phone orientation */
        @media (max-width: 896px) and (orientation: landscape) {
            .modal-backdrop .bg-white {
                max-height: 85vh;
                overflow-y: auto;
            }
            
            .py-8 {
                padding-top: 1rem !important;
                padding-bottom: 1rem !important;
            }
        }

        /* Print styles */
        @media print {
            .gradient-bg, nav, button, .modal-backdrop, .floating-action-btn {
                display: none !important;
            }
            
            .story-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #e5e7eb;
            }
        }

        /* Reduced motion preferences */
        @media (prefers-reduced-motion: reduce) {
            .story-card, .fade-in, .carousel-track, .notification, .floating-action-btn {
                transition: none !important;
                animation: none !important;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .bg-gray-50 {
                background-color: #1f2937 !important;
            }
            
            .bg-white {
                background-color: #374151 !important;
                color: #f9fafb !important;
            }
            
            .text-gray-900 {
                color: #f9fafb !important;
            }
            
            .text-gray-600 {
                color: #d1d5db !important;
            }
            
            .text-gray-700 {
                color: #e5e7eb !important;
            }
            
            .border-gray-300 {
                border-color: #4b5563 !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-full">
    <!-- Navigation -->
    <nav class="gradient-bg shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-white text-2xl font-bold">✈️ Map Your Memories</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="authSection" class="flex items-center space-x-4">
                        <button id="loginBtn" class="text-white hover:text-gray-200 px-3 py-2 rounded-md text-sm font-medium">Login</button>
                        <button id="signupBtn" class="bg-white text-sky-600 hover:bg-gray-100 px-4 py-2 rounded-md text-sm font-medium" style="color: #4BA3C3;">Sign Up</button>
                    </div>
                    <div id="userSection" class="hidden flex items-center space-x-4">
                        <span id="welcomeText" class="text-white text-sm">Welcome back!</span>
                        <button id="logoutBtn" class="text-white hover:text-gray-200 px-3 py-2 rounded-md text-sm font-medium">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

<section id="imageShowcase" class="mt-12">
    <h3 class="text-2xl font-bold mb-6 text-center" style="color:#0B3954;">Capture Every Moment</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="rounded-lg overflow-hidden shadow-lg">
            <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=800&q=80" alt="Travel 1" class="w-full h-48 object-cover">
        </div>
        <div class="rounded-lg overflow-hidden shadow-lg">
            <img src="https://images.unsplash.com/photo-1470770841072-f978cf4d019e?auto=format&fit=crop&w=800&q=80" alt="Travel 2" class="w-full h-48 object-cover">
        </div>
        <div class="rounded-lg overflow-hidden shadow-lg">
            <img src="https://images.unsplash.com/photo-1491553895911-0055eca6402d?auto=format&fit=crop&w=800&q=80" alt="Travel 3" class="w-full h-48 object-cover">
        </div>
    </div>
</section>

    
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Welcome Section -->
        <div id="welcomeSection" class="text-center mb-12">
            <h2 class="text-4xl font-bold mb-4" style="color: #0B3954;">Save Your Precious Memories </h2>
            <p class="text-xl text-gray-600 mb-8">Because every moment deserves to be remembered — capture your stories, relive your memories, and keep your journey alive forever in one beautiful space</p>
            <button id="getStartedBtn" class="gradient-bg text-white px-8 py-3 rounded-lg text-lg font-semibold hover:opacity-90 transition-opacity">Get Started</button>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="hidden">
            <!-- Search and Filter Bar -->
            <div class="rounded-lg shadow-md p-6 mb-8" style="background-color: #F9FAFB;">
                <div class="flex flex-col md:flex-row gap-4 items-center">
                    <div class="flex-1">
                        <input type="text" id="searchInput" placeholder="Search your travel stories..." 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent" style="--tw-ring-color: #4BA3C3;">
                    </div>
                    <div class="flex gap-2">
                        <input type="date" id="startDate" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2" style="--tw-ring-color: #4BA3C3;">
                        <input type="date" id="endDate" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2" style="--tw-ring-color: #4BA3C3;">
                    </div>
                    <button id="addStoryBtn" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90 transition-opacity">
                        + Add Story
                    </button>
                </div>
            </div>

            <!-- Stories Grid -->
            <div id="storiesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Stories will be populated here -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="hidden text-center py-12">
                <div class="text-6xl mb-4">📖</div>
                <h3 class="text-xl font-semibold mb-2" style="color: #0B3954;">No stories yet</h3>
                <p class="text-gray-600 mb-6">Start your journey by creating your first travel story!</p>
                <button class="gradient-bg text-white px-6 py-3 rounded-lg hover:opacity-90 transition-opacity" onclick="showAddStoryModal()">
                    Create Your First Story
                </button>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div id="floatingActionBtn" class="floating-action-btn hidden" onclick="showAddStoryModal()">
        <i class="fas fa-plus text-xl"></i>
    </div>

    <!-- Image Viewer -->
    <div id="imageViewer" class="image-viewer">
        <button class="image-viewer-close" onclick="closeImageViewer()">
            <i class="fas fa-times"></i>
        </button>
        <button class="image-viewer-nav image-viewer-prev" onclick="previousImageViewerImage()">
            <i class="fas fa-chevron-left"></i>
        </button>
        <img id="viewerImage" src="" alt="Viewer Image">
        <button class="image-viewer-nav image-viewer-next" onclick="nextImageViewerImage()">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="rounded-lg p-8 max-w-md w-full mx-4 fade-in" style="background-color: #F9FAFB;">
            <!-- Travel Image -->
            <div class="text-center mb-6">
                <svg width="120" height="80" viewBox="0 0 120 80" class="mx-auto mb-4">
                    <defs>
                        <linearGradient id="skyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#87CEEB"/>
                            <stop offset="100%" style="stop-color:#4BA3C3"/>
                        </linearGradient>
                        <linearGradient id="mountainGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#8B7355"/>
                            <stop offset="100%" style="stop-color:#5D4E37"/>
                        </linearGradient>
                    </defs>
                    <!-- Sky -->
                    <rect width="120" height="50" fill="url(#skyGradient)"/>
                    <!-- Mountains -->
                    <polygon points="0,50 30,25 60,40 90,20 120,35 120,50" fill="url(#mountainGradient)"/>
                    <!-- Ground -->
                    <rect y="50" width="120" height="30" fill="#8FBC8F"/>
                    <!-- Sun -->
                    <circle cx="90" cy="20" r="8" fill="#FFD700"/>
                    <!-- Clouds -->
                    <ellipse cx="25" cy="15" rx="8" ry="4" fill="white" opacity="0.8"/>
                    <ellipse cx="70" cy="12" rx="6" ry="3" fill="white" opacity="0.8"/>
                    <!-- Airplane -->
                    <g transform="translate(45,25)">
                        <ellipse cx="0" cy="0" rx="12" ry="2" fill="white"/>
                        <ellipse cx="-8" cy="0" rx="4" ry="1" fill="white"/>
                        <ellipse cx="8" cy="0" rx="2" ry="0.5" fill="white"/>
                    </g>
                </svg>
            </div>
            <h3 class="text-2xl font-bold mb-6 text-center" style="color: #0B3954;">Welcome Back</h3>
            <form id="loginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                    <input type="email" id="loginEmail" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2" style="--tw-ring-color: #4BA3C3;">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Password</label>
                    <input type="password" id="loginPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2" style="--tw-ring-color: #4BA3C3;">
                </div>
                <div class="mb-6 text-right">
                    <button type="button" onclick="showForgotPasswordModal()" class="text-sm" style="color: #4BA3C3;">Forgot Password?</button>
                </div>
                <div id="loginError" class="hidden mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm"></div>
                <div class="flex justify-between">
                    <button type="button" onclick="closeModal('loginModal')" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                    <button type="submit" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90 flex items-center justify-center min-w-[100px]">
                        <span id="loginBtnText">Login</span>
                        <div id="loginSpinner" class="loading-spinner ml-2 hidden"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Signup Modal -->
    <div id="signupModal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="rounded-lg p-8 max-w-md w-full mx-4 fade-in" style="background-color: #F9FAFB;">
            <h3 class="text-2xl font-bold mb-6" style="color: #0B3954;">Join Travel Stories</h3>
            <form id="signupForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Full Name</label>
                    <input type="text" id="signupName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                    <input type="email" id="signupEmail" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Password</label>
                    <input type="password" id="signupPassword" required minlength="6" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                    <p class="text-xs text-gray-500 mt-1">Password must be at least 6 characters long</p>
                </div>
                <div id="signupError" class="hidden mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm"></div>
                <div class="flex justify-between">
                    <button type="button" onclick="closeModal('signupModal')" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                    <button type="submit" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90 flex items-center justify-center min-w-[100px]">
                        <span id="signupBtnText">Sign Up</span>
                        <div id="signupSpinner" class="loading-spinner ml-2 hidden"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Story Modal -->
    <div id="storyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="rounded-lg p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto fade-in" style="background-color: #F9FAFB;">
            <h3 id="storyModalTitle" class="text-2xl font-bold mb-6" style="color: #0B3954;">Add New Story</h3>
            <form id="storyForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Story Title</label>
                    <input type="text" id="storyTitle" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Location</label>
                    <input type="text" id="storyLocation" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Travel Date</label>
                    <input type="date" id="storyDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Story</label>
                    <textarea id="storyContent" rows="6" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" placeholder="Tell us about your amazing travel experience..."></textarea>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Upload Images</label>
                    <input type="file" id="storyImage" accept="image/*" multiple class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                    <p class="text-sm text-gray-500 mt-1">You can select multiple images</p>
                    <div id="imagePreview" class="mt-4 hidden">
                        <div class="grid grid-cols-2 gap-2" id="previewGrid">
                            <!-- Image previews will appear here -->
                        </div>
                    </div>
                </div>
                <div class="flex justify-between">
                    <button type="button" onclick="closeModal('storyModal')" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                    <button type="submit" id="storySubmitBtn" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90 flex items-center justify-center min-w-[100px]">
                        <span id="storyBtnText">Save Story</span>
                        <div id="storySpinner" class="loading-spinner ml-2 hidden"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="rounded-lg p-8 max-w-md w-full mx-4 fade-in" style="background-color: #F9FAFB;">
            <h3 class="text-2xl font-bold text-gray-900 mb-6">Reset Password</h3>
            <form id="forgotPasswordForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Email Address</label>
                    <input type="email" id="forgotEmail" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                    <p class="text-xs text-gray-500 mt-1">Enter your email to reset your password</p>
                </div>
                <div id="forgotError" class="hidden mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm"></div>
                <div class="flex justify-between">
                    <button type="button" onclick="closeModal('forgotPasswordModal')" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                    <button type="submit" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90">Reset Password</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div id="resetPasswordModal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="rounded-lg p-8 max-w-md w-full mx-4 fade-in" style="background-color: #F9FAFB;">
            <h3 class="text-2xl font-bold text-gray-900 mb-6">Set New Password</h3>
            <form id="resetPasswordForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">New Password</label>
                    <input type="password" id="newPassword" required minlength="6" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Confirm New Password</label>
                    <input type="password" id="confirmNewPassword" required minlength="6" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                </div>
                <div id="resetError" class="hidden mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm"></div>
                <div class="flex justify-between">
                    <button type="button" onclick="closeModal('resetPasswordModal')" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                    <button type="submit" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90">Reset Password</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50">
        <div class="rounded-lg p-8 max-w-md w-full mx-4 fade-in" style="background-color: #F9FAFB;">
            <h3 class="text-xl font-bold text-gray-900 mb-4">Delete Story</h3>
            <p class="text-gray-600 mb-6">Are you sure you want to delete this story? This action cannot be undone.</p>
            <div class="flex justify-between">
                <button type="button" onclick="closeModal('deleteModal')" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                <button type="button" id="confirmDeleteBtn" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">Delete</button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let stories = [];
        let editingStoryId = null;
        let storyToDelete = null;
        let users = JSON.parse(localStorage.getItem('travelAppUsers')) || {};
        let resetTokens = JSON.parse(localStorage.getItem('resetTokens')) || {};
        let imageViewerImages = [];
        let imageViewerCurrentIndex = 0;

        const sampleStories = [];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
        });

        function initializeApp() {
            // Check if user is logged in (simulate with localStorage)
            const savedUser = localStorage.getItem('travelAppUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
                loadStories();
            }
        }

        function setupEventListeners() {
            // Auth buttons
            document.getElementById('loginBtn').addEventListener('click', () => showModal('loginModal'));
            document.getElementById('signupBtn').addEventListener('click', () => showModal('signupModal'));
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('getStartedBtn').addEventListener('click', () => showModal('signupModal'));

            // Forms
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('signupForm').addEventListener('submit', handleSignup);
            document.getElementById('storyForm').addEventListener('submit', handleStorySubmit);
            document.getElementById('forgotPasswordForm').addEventListener('submit', handleForgotPassword);
            document.getElementById('resetPasswordForm').addEventListener('submit', handleResetPassword);

            // Story actions
            document.getElementById('addStoryBtn').addEventListener('click', showAddStoryModal);
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);

            // Search and filter
            document.getElementById('searchInput').addEventListener('input', filterStories);
            document.getElementById('startDate').addEventListener('change', filterStories);
            document.getElementById('endDate').addEventListener('change', filterStories);

            // Image preview
            document.getElementById('storyImage').addEventListener('change', handleImagePreview);
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            if (modalId === 'storyModal') {
                resetStoryForm();
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            const loginBtnText = document.getElementById('loginBtnText');
            const loginSpinner = document.getElementById('loginSpinner');

            // Show loading state
            loginBtnText.textContent = 'Logging in...';
            loginSpinner.classList.remove('hidden');

            // Hide previous errors
            errorDiv.classList.add('hidden');

            // Simulate API call delay
            setTimeout(() => {
                // Check if user exists
                if (!users[email]) {
                    showError('loginError', 'No account found with this email address.');
                    resetLoginButton();
                    return;
                }

                // Check password
                if (users[email].password !== password) {
                    showError('loginError', 'Incorrect password. Please try again.');
                    resetLoginButton();
                    return;
                }

                // Successful login
                currentUser = {
                    id: users[email].id,
                    name: users[email].name,
                    email: email
                };
                localStorage.setItem('travelAppUser', JSON.stringify(currentUser));
                closeModal('loginModal');
                showDashboard();
                loadStories();
                showToast('Welcome back! Ready to share more adventures?', 'success');
                
                // Clear form
                document.getElementById('loginForm').reset();
                resetLoginButton();
            }, 1000);
        }

        function resetLoginButton() {
            document.getElementById('loginBtnText').textContent = 'Login';
            document.getElementById('loginSpinner').classList.add('hidden');
        }

        function handleSignup(e) {
            e.preventDefault();
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const signupBtnText = document.getElementById('signupBtnText');
            const signupSpinner = document.getElementById('signupSpinner');

            // Show loading state
            signupBtnText.textContent = 'Signing up...';
            signupSpinner.classList.remove('hidden');

            // Hide previous errors
            document.getElementById('signupError').classList.add('hidden');

            // Validate input
            if (!name || !email || !password) {
                showError('signupError', 'Please fill in all fields.');
                resetSignupButton();
                return;
            }

            if (password.length < 6) {
                showError('signupError', 'Password must be at least 6 characters long.');
                resetSignupButton();
                return;
            }

            // Simulate API call delay
            setTimeout(() => {
                // Check if user already exists
                if (users[email]) {
                    showError('signupError', 'An account with this email already exists. Please login instead.');
                    resetSignupButton();
                    return;
                }

                // Create new user
                const userId = Date.now();
                users[email] = {
                    id: userId,
                    name: name,
                    password: password,
                    createdAt: new Date().toISOString()
                };

                // Save users to localStorage
                localStorage.setItem('travelAppUsers', JSON.stringify(users));

                // Log in the new user
                currentUser = {
                    id: userId,
                    name: name,
                    email: email
                };
                localStorage.setItem('travelAppUser', JSON.stringify(currentUser));
                closeModal('signupModal');
                showDashboard();
                loadStories();
                showToast('Welcome to Travel Stories! Start sharing your adventures.', 'success');
                
                // Clear form
                document.getElementById('signupForm').reset();
                resetSignupButton();
            }, 1000);
        }

        function resetSignupButton() {
            document.getElementById('signupBtnText').textContent = 'Sign Up';
            document.getElementById('signupSpinner').classList.add('hidden');
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('travelAppUser');
            stories = [];
            showWelcome();
            showToast('See you next time, happy travels!', 'info');
        }

        function showWelcome() {
            document.getElementById('welcomeSection').classList.remove('hidden');
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('userSection').classList.add('hidden');
            document.getElementById('floatingActionBtn').classList.add('hidden');
        }

        function showDashboard() {
            document.getElementById('welcomeSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('userSection').classList.remove('hidden');
            document.getElementById('welcomeText').textContent = `Welcome back, ${currentUser.name}!`;
            document.getElementById('floatingActionBtn').classList.remove('hidden');
        }

        function loadStories() {
            // Load user's stories from localStorage
            const userStoriesKey = `travelStories_${currentUser.id}`;
            const savedStories = localStorage.getItem(userStoriesKey);
            
            if (savedStories) {
                stories = JSON.parse(savedStories);
            } else {
                stories = [];
            }
            
            renderStories(stories);
        }

        function renderStories(storiesToRender) {
            const grid = document.getElementById('storiesGrid');
            const emptyState = document.getElementById('emptyState');

            if (storiesToRender.length === 0) {
                grid.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            grid.classList.remove('hidden');
            emptyState.classList.add('hidden');

            // Sort stories - pinned first, then by date
            const sortedStories = [...storiesToRender].sort((a, b) => {
                if (a.pinned && !b.pinned) return -1;
                if (!a.pinned && b.pinned) return 1;
                return new Date(b.createdAt) - new Date(a.createdAt);
            });

            grid.innerHTML = sortedStories.map(story => `
                <div class="story-card bg-white rounded-lg shadow-md overflow-hidden">
                    ${story.pinned ? '<div class="pinned-badge text-white text-xs px-2 py-1 absolute top-2 right-2 rounded-full z-10">📌 Pinned</div>' : ''}
                    <div class="relative">
                        ${story.images && story.images.length > 1 ? 
                            `<div class="carousel-container" style="height: 200px;">
                                <div class="carousel-track" id="carousel-${story.id}">
                                    ${story.images.map((img, index) => 
                                        `<div class="carousel-slide">
                                            <img src="${img}" alt="${story.title} - Image ${index + 1}" class="w-full h-full object-contain bg-gray-100 cursor-pointer" onclick="openImageViewer(${story.id}, ${index})">
                                        </div>`
                                    ).join('')}
                                </div>
                                ${story.images.length > 1 ? `
                                    <button class="carousel-nav carousel-prev" onclick="previousSlide(${story.id})">‹</button>
                                    <button class="carousel-nav carousel-next" onclick="nextSlide(${story.id})">›</button>
                                    <div class="carousel-indicators">
                                        ${story.images.map((_, index) => 
                                            `<div class="carousel-dot ${index === 0 ? 'active' : ''}" onclick="goToSlide(${story.id}, ${index})"></div>`
                                        ).join('')}
                                    </div>
                                ` : ''}
                            </div>` :
                            `<img src="${story.images ? story.images[0] : story.image}" alt="${story.title}" class="w-full story-image object-contain bg-gray-100 cursor-pointer" onclick="openImageViewer(${story.id}, 0)">`
                        }
                        <div class="story-actions absolute bottom-2 left-2 z-10">
                            <button onclick="toggleLike(${story.id})" class="like-button ${story.liked ? 'liked' : ''} bg-white bg-opacity-90 rounded-full p-2 shadow-md">
                                <i class="fas fa-heart ${story.liked ? 'text-red-500' : 'text-gray-600'}"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">${story.title}</h3>
                        <p class="text-orange-600 text-sm mb-2">📍 ${story.location}</p>
                        <p class="text-gray-500 text-sm mb-3">📅 ${formatDate(story.date)}</p>
                        <p class="text-gray-700 mb-4 line-clamp-3">${story.content}</p>
                        <div class="story-stats">
                            <div class="stat-item">
                                <i class="fas fa-heart ${story.liked ? 'text-red-500' : 'text-gray-500'}"></i>
                                <span>${story.likes || 0}</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mt-4">
                            <button onclick="togglePin(${story.id})" class="text-sm ${story.pinned ? 'text-yellow-600' : 'text-gray-500'} hover:text-yellow-600">
                                ${story.pinned ? '📌 Unpin' : '📌 Pin'}
                            </button>
                            <div class="flex space-x-2">
                                <button onclick="editStory(${story.id})" class="text-blue-600 hover:text-blue-800 text-sm">✏️ Edit</button>
                                <button onclick="deleteStory(${story.id})" class="text-red-600 hover:text-red-800 text-sm">🗑️ Delete</button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Initialize carousels after rendering
            setTimeout(() => {
                initializeAllCarousels();
            }, 100);
        }

        function toggleLike(storyId) {
            const story = stories.find(s => s.id === storyId);
            if (story) {
                story.liked = !story.liked;
                story.likes = story.likes || 0;
                
                if (story.liked) {
                    story.likes += 1;
                    showToast('Story liked!', 'success');
                } else {
                    story.likes -= 1;
                    showToast('Story unliked', 'info');
                }
                
                // Save to localStorage
                const userStoriesKey = `travelStories_${currentUser.id}`;
                localStorage.setItem(userStoriesKey, JSON.stringify(stories));
                
                renderStories(stories);
            }
        }

        function showAddStoryModal() {
            editingStoryId = null;
            document.getElementById('storyModalTitle').textContent = 'Add New Story';
            document.getElementById('storyBtnText').textContent = 'Save Story';
            resetStoryForm();
            showModal('storyModal');
        }

        function editStory(id) {
            const story = stories.find(s => s.id === id);
            if (!story) return;

            editingStoryId = id;
            document.getElementById('storyModalTitle').textContent = 'Edit Story';
            document.getElementById('storyBtnText').textContent = 'Update Story';
            
            document.getElementById('storyTitle').value = story.title;
            document.getElementById('storyLocation').value = story.location;
            document.getElementById('storyDate').value = story.date;
            document.getElementById('storyContent').value = story.content;
            
            if (story.images && story.images.length > 0) {
                document.getElementById('imagePreview').classList.remove('hidden');
                const previewGrid = document.getElementById('previewGrid');
                previewGrid.innerHTML = story.images.map((img, index) => `
                    <div class="relative">
                        <img src="${img}" alt="Story image ${index + 1}" class="w-full h-24 object-cover rounded-lg">
                        <span class="absolute top-1 right-1 bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs">✓</span>
                    </div>
                `).join('');
            }
            
            showModal('storyModal');
        }

        function deleteStory(id) {
            storyToDelete = id;
            showModal('deleteModal');
        }

        function confirmDelete() {
            if (storyToDelete) {
                stories = stories.filter(s => s.id !== storyToDelete);
                
                // Save to localStorage
                const userStoriesKey = `travelStories_${currentUser.id}`;
                localStorage.setItem(userStoriesKey, JSON.stringify(stories));
                
                renderStories(stories);
                closeModal('deleteModal');
                showToast('Story deleted successfully', 'success');
                storyToDelete = null;
            }
        }

        function togglePin(id) {
            const story = stories.find(s => s.id === id);
            if (story) {
                story.pinned = !story.pinned;
                
                // Save to localStorage
                const userStoriesKey = `travelStories_${currentUser.id}`;
                localStorage.setItem(userStoriesKey, JSON.stringify(stories));
                
                renderStories(stories);
                showToast(story.pinned ? 'Story pinned to top!' : 'Story unpinned', 'info');
            }
        }

        function handleStorySubmit(e) {
            e.preventDefault();
            
            const title = document.getElementById('storyTitle').value;
            const location = document.getElementById('storyLocation').value;
            const date = document.getElementById('storyDate').value;
            const content = document.getElementById('storyContent').value;
            const imageFiles = Array.from(document.getElementById('storyImage').files);
            const storyBtnText = document.getElementById('storyBtnText');
            const storySpinner = document.getElementById('storySpinner');

            // Show loading state
            storyBtnText.textContent = 'Saving...';
            storySpinner.classList.remove('hidden');

            const storyData = {
                title,
                location,
                date,
                content,
                pinned: false,
                createdAt: new Date().toISOString()
            };

            if (imageFiles.length > 0) {
                const imagePromises = imageFiles.map(file => {
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            resolve(e.target.result);
                        };
                        reader.readAsDataURL(file);
                    });
                });

                Promise.all(imagePromises).then(images => {
                    storyData.images = images;
                    storyData.image = images[0]; // Keep backward compatibility
                    saveStory(storyData);
                    resetStoryButton();
                });
            } else if (editingStoryId) {
                const existingStory = stories.find(s => s.id === editingStoryId);
                storyData.images = existingStory.images;
                storyData.image = existingStory.image;
                saveStory(storyData);
                resetStoryButton();
            } else {
                // Generate a placeholder image for new stories without uploads
                const placeholderImage = generatePlaceholderImage(location);
                storyData.images = [placeholderImage];
                storyData.image = placeholderImage;
                saveStory(storyData);
                resetStoryButton();
            }
        }

        function resetStoryButton() {
            document.getElementById('storyBtnText').textContent = editingStoryId ? 'Update Story' : 'Save Story';
            document.getElementById('storySpinner').classList.add('hidden');
        }

        function saveStory(storyData) {
            if (editingStoryId) {
                const index = stories.findIndex(s => s.id === editingStoryId);
                stories[index] = { ...stories[index], ...storyData };
                showToast('Story updated successfully!', 'success');
            } else {
                storyData.id = Date.now();
                stories.unshift(storyData);
                showToast('New story added successfully!', 'success');
            }
            
            // Save to localStorage
            const userStoriesKey = `travelStories_${currentUser.id}`;
            localStorage.setItem(userStoriesKey, JSON.stringify(stories));
            
            renderStories(stories);
            closeModal('storyModal');
        }

        function generatePlaceholderImage(location) {
            const colors = ['#ff6b6b', '#ffa726', '#ff8a65', '#ffab40', '#ff7043', '#ffcc02'];
            const color1 = colors[Math.floor(Math.random() * colors.length)];
            const color2 = colors[Math.floor(Math.random() * colors.length)];
            
            return `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200' viewBox='0 0 400 200'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:${encodeURIComponent(color1)}'/%3E%3Cstop offset='100%25' style='stop-color:${encodeURIComponent(color2)}'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='400' height='200' fill='url(%23grad)'/%3E%3Ctext x='200' y='100' text-anchor='middle' fill='white' font-size='24' font-weight='bold'%3E${encodeURIComponent(location)}%3C/text%3E%3C/svg%3E`;
        }

        function handleImagePreview(e) {
            const files = Array.from(e.target.files); // No limit on images
            const previewGrid = document.getElementById('previewGrid');
            
            if (files.length > 0) {
                document.getElementById('imagePreview').classList.remove('hidden');
                previewGrid.innerHTML = '';
                
                files.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imgContainer = document.createElement('div');
                        imgContainer.className = 'relative';
                        imgContainer.innerHTML = `
                            <img src="${e.target.result}" alt="Preview ${index + 1}" class="w-full h-24 object-cover rounded-lg">
                            <button type="button" onclick="removePreviewImage(${index})" class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600">×</button>
                        `;
                        previewGrid.appendChild(imgContainer);
                    };
                    reader.readAsDataURL(file);
                });
            } else {
                document.getElementById('imagePreview').classList.add('hidden');
            }
        }

        function removePreviewImage(index) {
            const fileInput = document.getElementById('storyImage');
            const dt = new DataTransfer();
            const files = Array.from(fileInput.files);
            
            files.forEach((file, i) => {
                if (i !== index) {
                    dt.items.add(file);
                }
            });
            
            fileInput.files = dt.files;
            handleImagePreview({ target: fileInput });
        }

        function resetStoryForm() {
            document.getElementById('storyForm').reset();
            document.getElementById('imagePreview').classList.add('hidden');
            editingStoryId = null;
        }

        function filterStories() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            let filtered = stories.filter(story => {
                const matchesSearch = story.title.toLowerCase().includes(searchTerm) ||
                                    story.location.toLowerCase().includes(searchTerm) ||
                                    story.content.toLowerCase().includes(searchTerm);
                
                const storyDate = new Date(story.date);
                const matchesDateRange = (!startDate || storyDate >= new Date(startDate)) &&
                                       (!endDate || storyDate <= new Date(endDate));
                
                return matchesSearch && matchesDateRange;
            });

            renderStories(filtered);
        }

        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        function showError(errorId, message) {
            const errorDiv = document.getElementById(errorId);
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function showForgotPasswordModal() {
            closeModal('loginModal');
            showModal('forgotPasswordModal');
        }

        function handleForgotPassword(e) {
            e.preventDefault();
            const email = document.getElementById('forgotEmail').value;

            // Hide previous errors
            document.getElementById('forgotError').classList.add('hidden');

            // Check if user exists
            if (!users[email]) {
                showError('forgotError', 'No account found with this email address.');
                return;
            }

            // Store email for password reset
            localStorage.setItem('resetEmail', email);
            
            closeModal('forgotPasswordModal');
            showModal('resetPasswordModal');
            document.getElementById('forgotPasswordForm').reset();
        }

        function handleResetPassword(e) {
            e.preventDefault();
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;

            // Hide previous errors
            document.getElementById('resetError').classList.add('hidden');

            // Validate passwords match
            if (newPassword !== confirmPassword) {
                showError('resetError', 'Passwords do not match.');
                return;
            }

            if (newPassword.length < 6) {
                showError('resetError', 'Password must be at least 6 characters long.');
                return;
            }

            // Get the email from localStorage
            const userEmail = localStorage.getItem('resetEmail');
            
            if (!userEmail || !users[userEmail]) {
                showError('resetError', 'Reset session expired. Please try again.');
                return;
            }

            // Update password
            users[userEmail].password = newPassword;
            localStorage.setItem('travelAppUsers', JSON.stringify(users));

            // Clean up
            localStorage.removeItem('resetEmail');

            closeModal('resetPasswordModal');
            showToast('Password reset successfully! You can now login with your new password.', 'success');
            showModal('loginModal');
            
            // Clear form
            document.getElementById('resetPasswordForm').reset();
        }

        function showToast(message, type = 'info') {
            // Create toast notification
            const toast = document.createElement('div');
            toast.className = `notification ${type}`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(toast);
            
            // Show toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // Remove toast after delay
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 5000);
        }

        // Carousel functionality
        const carouselStates = {};

        function initializeCarousel(storyId, imageCount) {
            carouselStates[storyId] = {
                currentSlide: 0,
                totalSlides: imageCount
            };
        }

        function nextSlide(storyId) {
            if (!carouselStates[storyId]) return;
            
            const state = carouselStates[storyId];
            state.currentSlide = (state.currentSlide + 1) % state.totalSlides;
            updateCarousel(storyId);
        }

        function previousSlide(storyId) {
            if (!carouselStates[storyId]) return;
            
            const state = carouselStates[storyId];
            state.currentSlide = (state.currentSlide - 1 + state.totalSlides) % state.totalSlides;
            updateCarousel(storyId);
        }

        function goToSlide(storyId, slideIndex) {
            if (!carouselStates[storyId]) return;
            
            carouselStates[storyId].currentSlide = slideIndex;
            updateCarousel(storyId);
        }

        function updateCarousel(storyId) {
            const carousel = document.getElementById(`carousel-${storyId}`);
            const state = carouselStates[storyId];
            
            if (carousel && state) {
                const translateX = -state.currentSlide * 100;
                carousel.style.transform = `translateX(${translateX}%)`;
                
                // Update indicators
                const indicators = carousel.parentElement.querySelectorAll('.carousel-dot');
                indicators.forEach((dot, index) => {
                    dot.classList.toggle('active', index === state.currentSlide);
                });
            }
        }

        // Initialize carousels after rendering stories
        function initializeAllCarousels() {
            stories.forEach(story => {
                if (story.images && story.images.length > 1) {
                    initializeCarousel(story.id, story.images.length);
                }
            });
        }

        // Image viewer functionality
        function openImageViewer(storyId, imageIndex) {
            const story = stories.find(s => s.id === storyId);
            if (!story || !story.images) return;
            
            imageViewerImages = story.images;
            imageViewerCurrentIndex = imageIndex;
            
            document.getElementById('viewerImage').src = imageViewerImages[imageViewerCurrentIndex];
            document.getElementById('imageViewer').classList.add('active');
        }

        function closeImageViewer() {
            document.getElementById('imageViewer').classList.remove('active');
            imageViewerImages = [];
            imageViewerCurrentIndex = 0;
        }

        function nextImageViewerImage() {
            if (imageViewerImages.length === 0) return;
            
            imageViewerCurrentIndex = (imageViewerCurrentIndex + 1) % imageViewerImages.length;
            document.getElementById('viewerImage').src = imageViewerImages[imageViewerCurrentIndex];
        }

        function previousImageViewerImage() {
            if (imageViewerImages.length === 0) return;
            
            imageViewerCurrentIndex = (imageViewerCurrentIndex - 1 + imageViewerImages.length) % imageViewerImages.length;
            document.getElementById('viewerImage').src = imageViewerImages[imageViewerCurrentIndex];
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-backdrop')) {
                const modals = ['loginModal', 'signupModal', 'storyModal', 'deleteModal', 'forgotPasswordModal', 'resetPasswordModal'];
                modals.forEach(modalId => {
                    if (!document.getElementById(modalId).classList.contains('hidden')) {
                        closeModal(modalId);
                    }
                });
            }
        });

        // Close image viewer when clicking outside the image
        document.getElementById('imageViewer').addEventListener('click', function(e) {
            if (e.target === this) {
                closeImageViewer();
            }
        });

        document.addEventListener('keydown', function(e) {
            if (document.getElementById('imageViewer').classList.contains('active')) {
                if (e.key === 'Escape') {
                    closeImageViewer();
                } else if (e.key === 'ArrowRight') {
                    nextImageViewerImage();
                } else if (e.key === 'ArrowLeft') {
                    previousImageViewerImage();
                }
            }
        });
    </script>
</body>
</html>